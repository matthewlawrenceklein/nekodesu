<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4">
  <div class="max-w-4xl mx-auto">
    <%# Score Summary %>
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8 text-center">
      <h1 class="text-3xl font-bold text-gray-900 mb-4">Comprehension Complete!</h1>

      <div class="inline-block">
        <div class="text-6xl font-bold mb-2 <%= @attempt.score_percentage >= 70 ? 'text-green-600' : 'text-orange-600' %>">
          <%= @attempt.score_percentage %>%
        </div>
        <div class="text-gray-600 text-lg">
          <%= @attempt.correct_count %> out of <%= @attempt.total_questions %> correct
        </div>
      </div>

      <% if @attempt.score_percentage >= 90 %>
        <p class="mt-4 text-lg text-green-700">üéâ Excellent work!</p>
      <% elsif @attempt.score_percentage >= 70 %>
        <p class="mt-4 text-lg text-blue-700">üëç Good job!</p>
      <% else %>
        <p class="mt-4 text-lg text-orange-700">Keep practicing!</p>
      <% end %>
    </div>

    <%# Dialogue Review %>
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">Dialogue Review</h2>

      <div class="mb-8">
        <h3 class="text-lg font-semibold text-gray-700 mb-3">Japanese</h3>
        <div class="text-xl leading-relaxed text-gray-900 font-japanese">
          <%= simple_format(@dialogue.japanese_text) %>
        </div>
      </div>

      <div class="border-t pt-6">
        <h3 class="text-lg font-semibold text-gray-700 mb-3">English Translation</h3>
        <div class="text-lg leading-relaxed text-gray-700">
          <%= simple_format(@dialogue.english_translation) %>
        </div>
      </div>
    </div>

    <%# Question Review %>
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">Question Review</h2>

      <div class="space-y-6">
        <% @attempt.selected_questions.each_with_index do |question, index| %>
          <% user_answer = @attempt.answers[question.id.to_s] %>
          <% is_correct = user_answer["correct"] %>

          <div class="border-l-4 <%= is_correct ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50' %> p-4 rounded-r-lg">
            <div class="flex items-start justify-between mb-3">
              <h3 class="font-semibold text-gray-900">
                <%= index + 1 %>. <%= question.question_text %>
              </h3>
              <span class="flex-shrink-0 ml-4 <%= is_correct ? 'text-green-600' : 'text-red-600' %> font-bold">
                <%= is_correct ? '‚úì Correct' : '‚úó Incorrect' %>
              </span>
            </div>

            <div class="space-y-2">
              <% question.options.each_with_index do |option, opt_index| %>
                <% is_selected = user_answer["selected_index"] == opt_index %>
                <% is_correct_answer = question.correct_option_index == opt_index %>

                <div class="p-3 rounded <%= is_correct_answer ? 'bg-green-100 border-2 border-green-500' : (is_selected ? 'bg-red-100 border-2 border-red-500' : 'bg-white border border-gray-200') %>">
                  <div class="flex items-center">
                    <span class="flex-shrink-0 w-6 h-6 rounded-full <%= is_correct_answer ? 'bg-green-500 text-white' : (is_selected ? 'bg-red-500 text-white' : 'bg-gray-300 text-gray-700') %> flex items-center justify-center text-sm font-semibold mr-3">
                      <%= ('A'.ord + opt_index).chr %>
                    </span>
                    <span class="<%= is_correct_answer ? 'font-semibold text-gray-900' : 'text-gray-700' %>">
                      <%= option %>
                    </span>
                    <% if is_correct_answer %>
                      <span class="ml-auto text-green-600 font-semibold">‚úì Correct Answer</span>
                    <% elsif is_selected %>
                      <span class="ml-auto text-red-600 font-semibold">Your Answer</span>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>

            <% if question.explanation.present? %>
              <div class="mt-3 text-sm text-gray-600 italic">
                üí° <%= question.explanation %>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <%# Actions %>
    <div class="text-center space-x-4">
      <%= button_to "Try Again (New Questions)", start_dialogue_path(@dialogue), method: :post, class: "inline-block bg-green-600 hover:bg-green-700 text-white font-bold text-lg py-4 px-8 rounded-lg transition duration-200" %>
      <%= link_to "Return to Dashboard", root_path, class: "inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold text-lg py-4 px-8 rounded-lg transition duration-200" %>
    </div>
  </div>
</div>

<style>
  .font-japanese {
    font-family: 'Hiragino Kaku Gothic Pro', '„Éí„É©„ÇÆ„ÉéËßí„Ç¥ Pro W3', 'Meiryo', '„É°„Ç§„É™„Ç™', sans-serif;
    line-height: 2;
  }
</style>
